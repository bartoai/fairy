<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ai testing grounds</title>
    <link rel="icon" type="image/png" href="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887e196a6ca43c1525219f5_ChatGPT%20Image%20Jul%2028%2C%202025%2C%2009_46_08%20PM.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', monospace;
            height: 100vh;
            overflow: hidden;
            background: #000;
            position: relative;
        }

        /* Grok Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .grok-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .grok-title {
            font-size: 48px;
            font-weight: 900;
            color: #00ff88;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            letter-spacing: 3px;
        }

        .grok-subtitle {
            font-size: 18px;
            color: #8892b0;
            font-weight: 400;
            letter-spacing: 1px;
        }

        .floating-windows {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 40px;
            max-width: 600px;
        }

        .floating-window {
            width: 280px;
            height: 250px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            animation: float 3s ease-in-out infinite;
        }

        .floating-window:nth-child(1) { animation-delay: 0s; }
        .floating-window:nth-child(2) { animation-delay: 0.5s; }
        .floating-window:nth-child(3) { animation-delay: 1s; }
        .floating-window:nth-child(4) { animation-delay: 1.5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .floating-window:hover {
            transform: scale(1.05);
            border-color: #00ff88;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .floating-window.active {
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
            cursor: pointer;
        }

        .floating-window.active:hover {
            transform: scale(1.08);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.6);
        }

        .floating-window:not(.active) {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .window-image {
            width: 100%;
            height: 160px;
            border-radius: 8px;
            object-fit: cover;
            object-position: center top;
            margin-bottom: 10px;
        }

        .window-name {
            color: #00ff88;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .window-status {
            color: #8892b0;
            font-size: 12px;
            text-align: center;
            opacity: 0.8;
        }

        .window-status.active {
            color: #00ff88;
        }

        .access-button {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            border: 2px solid #00ff88;
            color: #0a0a0a;
            font-family: 'Courier Prime', monospace;
            font-size: 18px;
            font-weight: bold;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            margin-bottom: 20px;
        }

        .access-button:hover {
            background: linear-gradient(45deg, #00cc6a, #00aa55);
            transform: translateY(-3px);
            box-shadow: 0 10px 40px rgba(0, 255, 136, 0.5);
        }

        .grok-warning {
            color: #ff6b6b;
            font-size: 14px;
            text-align: center;
            opacity: 0.9;
            letter-spacing: 1px;
        }

        /* Main content */
        .main-content {
            opacity: 0;
            transition: opacity 1s ease;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            height: 100vh;
        }

        .main-content.visible {
            opacity: 1;
        }

        /* Testing Interface Header */
        .testing-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 15px 20px;
            z-index: 15;
            backdrop-filter: blur(10px);
        }

        .testing-title {
            color: #00ff88;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .testing-subtitle {
            color: #8892b0;
            font-size: 12px;
            opacity: 0.8;
        }

        .testing-status {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #00ff88;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Testing Controls Panel */
        .testing-controls {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 280px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 20px;
            z-index: 20;
            backdrop-filter: blur(15px);
        }

        .controls-title {
            color: #00ff88;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            padding-bottom: 10px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .section-label {
            color: #8892b0;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .control-button {
            width: 100%;
            background: transparent;
            border: 1px solid rgba(0, 255, 136, 0.4);
            color: #00ff88;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-family: 'Courier Prime', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-button:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            transform: translateX(5px);
        }

        .control-button.active {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .parameter-slider {
            margin-bottom: 15px;
        }

        .slider-label {
            color: #8892b0;
            font-size: 11px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(136, 146, 176, 0.2);
            outline: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
        }

        /* Performance Monitor */
        .performance-monitor {
            position: fixed;
            right: 20px;
            top: 100px;
            width: 200px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 15px;
            z-index: 20;
            backdrop-filter: blur(15px);
        }

        .monitor-title {
            color: #00ff88;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 11px;
        }

        .metric-label {
            color: #8892b0;
        }

        .metric-value {
            color: #00ff88;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 3px;
            background: rgba(136, 146, 176, 0.2);
            border-radius: 2px;
            margin-top: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Character model */
        .character-container {
            position: absolute;
            bottom: 270px;
            left: 50%;
            transform: translateX(-50%);
            width: 1700px;
            height: 750px;
            z-index: 5;
        }

        .character-canvas {
            width: 100%;
            height: 100%;
            display: none;
        }

        .character-loading {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            text-align: center;
            flex-direction: column;
            gap: 10px;
        }

        /* Text box */
        .text-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1200px;
            height: 250px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #333;
            border-radius: 8px;
            z-index: 10;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
        }

        .character-name {
            color: #00ff00;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .dialogue-text {
            color: #ffffff;
            font-size: 14px;
            line-height: 1.6;
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding-right: 10px;
        }

        .dialogue-text::-webkit-scrollbar {
            width: 6px;
        }

        .dialogue-text::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .dialogue-text::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        .message {
            margin-bottom: 15px;
            padding: 8px 0;
            position: relative;
        }

        .message.user {
            color: #ffff00;
        }

        .message.user::before {
            content: "> ";
            color: #00ff00;
        }

        .message.fairy {
            color: #ffffff;
            position: relative;
        }

        .voice-button {
            position: absolute;
            right: 10px;
            top: 8px;
            background: transparent;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            font-family: 'Courier Prime', monospace;
            transition: all 0.3s ease;
        }

        .voice-button:hover:not(:disabled) {
            background: rgba(0, 255, 0, 0.1);
        }

        .voice-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .voice-button.playing {
            background: rgba(0, 255, 0, 0.2);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .typing-indicator {
            color: #00ff00;
            font-style: italic;
            margin-bottom: 15px;
            padding: 8px 0;
        }

        .reaction-buttons {
            position: absolute;
            right: 50px;
            top: 8px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message.fairy:hover .reaction-buttons {
            opacity: 1;
        }

        .reaction-btn {
            background: transparent;
            border: 1px solid #333;
            color: #fff;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .reaction-btn:hover {
            background: rgba(0, 255, 0, 0.1);
            border-color: #00ff00;
        }

        .user-reactions {
            margin-top: 5px;
            font-size: 12px;
            color: #888;
        }

        .reaction-count {
            display: inline-block;
            margin-right: 10px;
            padding: 2px 6px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 3px;
            border: 1px solid #333;
        }

        .memory-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 15;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .memory-indicator.show {
            opacity: 1;
        }

        .background-selector {
            position: fixed;
            top: 50%;
            right: -300px;
            transform: translateY(-50%);
            width: 280px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            z-index: 20;
            transition: right 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        .background-selector.open {
            right: 20px;
        }

        .bg-toggle-btn {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 25;
            width: 44px;
            height: 44px;
            background-image: url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887f4a60b66f3edf3a7b978_2303929-200%20(1).png');
            background-size: 24px 24px;
            background-repeat: no-repeat;
            background-position: center;
            transition: all 0.3s ease;
        }

        .bg-toggle-btn:hover {
            background-color: rgba(0, 255, 0, 0.1);
        }

        .bg-selector-title {
            color: #00ff00;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .background-option {
            width: 100%;
            height: 60px;
            background-size: cover;
            background-position: center;
            border: 2px solid #333;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .background-option:hover {
            border-color: #00ff00;
            transform: scale(1.02);
        }

        .background-option.active {
            border-color: #00ff00;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }

        .background-option::after {
            content: attr(data-name);
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 12px;
            padding: 5px;
            text-align: center;
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: 10px;
            border-top: 1px solid #333;
            padding-top: 15px;
        }

        .input-prompt {
            color: #00ff00;
            font-size: 14px;
            white-space: nowrap;
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-family: 'Courier Prime', monospace;
            font-size: 14px;
            outline: none;
            padding: 2px;
            border-bottom: 1px solid #333;
        }

        .message-input:focus {
            border-bottom-color: #00ff00;
        }

        .mic-button {
            background: transparent;
            border: 1px solid #333;
            color: #00ff00;
            padding: 8px 12px;
            font-family: 'Courier Prime', monospace;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            min-width: 44px;
            min-height: 36px;
            background-image: url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887eb2c600a7b6a759912ee_image%20(59).png');
            background-size: 24px 24px;
            background-repeat: no-repeat;
            background-position: center;
        }

        .mic-button:hover:not(:disabled) {
            background-color: rgba(0, 255, 0, 0.1);
            border-color: #00ff00;
        }

        .mic-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .mic-button.recording {
            background-color: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
            color: #ff0000;
            animation: pulse 1s infinite;
            background-image: none;
        }

        .send-button {
            background: transparent;
            border: 1px solid #333;
            color: #00ff00;
            padding: 6px 12px;
            font-family: 'Courier Prime', monospace;
            font-size: 12px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .send-button:hover:not(:disabled) {
            background: rgba(0, 255, 0, 0.1);
            border-color: #00ff00;
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .floating-windows {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .floating-window {
                width: 280px;
            }
            
            .grok-title {
                font-size: 36px;
            }
            
            .character-container {
                width: 400px;
                height: 550px;
                bottom: 280px;
            }

            .text-box {
                width: 95%;
                height: 270px;
                padding: 15px;
                bottom: 10px;
            }
        }
    </style>
</head>
    <body>
    <!-- Grok Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="grok-header">
            <div class="grok-title"></div>
            <div class="grok-subtitle">Advanced AI Testing Interface</div>
        </div>

        <div class="floating-windows">
            <div class="floating-window">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/688c38f0fa8c1caa83ab1715_ChatGPT_Image_Aug_1__2025__04_39_33_AM-removebg-preview.png" 
                     alt="Ani" class="window-image">
                <div class="window-name">ANI</div>
                <div class="window-status">Offline</div>
            </div>

            <div class="floating-window">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/688c38f0da41a37b7528209a_ChatGPT_Image_Aug_1__2025__04_42_54_AM-removebg-preview.png" 
                     alt="Rudi" class="window-image">
                <div class="window-name">RUDI</div>
                <div class="window-status">Offline</div>
            </div>

            <div class="floating-window">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/688c38f0cffa969068ca3da7_ChatGPT_Image_Aug_1__2025__04_46_28_AM-removebg-preview.png" 
                     alt="Valentine" class="window-image">
                <div class="window-name">VALENTINE</div>
                <div class="window-status">Offline</div>
            </div>

            <div class="floating-window active" onclick="enterSite()">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/688c3a0a64d23f99c0106e85_ChatGPT_Image_Aug_1__2025__04_52_13_AM-removebg-preview.png" 
                     alt="Aether" class="window-image">
                <div class="window-name">AETHER</div>
                <div class="window-status active">Neural Network Active</div>
            </div>
        </div>

        <div class="grok-warning">
            Beta Testing Environment • Developer Access Only • Unstable Build
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content">
        <!-- Testing Interface Header -->
        <div class="testing-header">
            <div class="testing-title">GROK COMPANION - AETHER PROTOCOL</div>
            <div class="testing-subtitle">Neural Network Testing Environment v2.1.4</div>
            <div class="testing-status">
                <span class="status-dot"></span>
                ACTIVE SESSION
            </div>
        </div>

        <!-- Testing Controls Panel -->
        <div class="testing-controls">
            <div class="controls-title">TESTING CONTROLS</div>
            
            <div class="control-section">
                <div class="section-label">ANIMATION</div>
                <button class="control-button" onclick="triggerPose('idle')">IDLE POSE</button>
                <button class="control-button" onclick="triggerPose('wave')">WAVE GESTURE</button>
                <button class="control-button" onclick="triggerPose('dance')">ANIMATE SEQUENCE</button>
                <button class="control-button" onclick="resetCharacter()">RESET POSITION</button>
            </div>

            <div class="control-section">
                <div class="section-label">NEURAL PARAMETERS</div>
                <div class="parameter-slider">
                    <div class="slider-label">
                        <span>Response Speed</span>
                        <span id="speedValue">0.8</span>
                    </div>
                    <input type="range" min="0.1" max="2.0" step="0.1" value="0.8" class="slider" id="speedSlider">
                </div>
                <div class="parameter-slider">
                    <div class="slider-label">
                        <span>Personality Intensity</span>
                        <span id="intensityValue">0.9</span>
                    </div>
                    <input type="range" min="0.1" max="1.0" step="0.1" value="0.9" class="slider" id="intensitySlider">
                </div>
            </div>

            <div class="control-section">
                <div class="section-label">SYSTEM</div>
                <button class="control-button" onclick="toggleMemory()">TOGGLE MEMORY</button>
                <button class="control-button" onclick="exportLogs()">EXPORT LOGS</button>
                <button class="control-button" onclick="emergencyStop()">EMERGENCY STOP</button>
            </div>
        </div>

        <!-- Performance Monitor -->
        <div class="performance-monitor">
            <div class="monitor-title">PERFORMANCE</div>
            <div class="metric">
                <span class="metric-label">CPU Usage:</span>
                <span class="metric-value" id="cpuUsage">67%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 67%"></div>
            </div>
            
            <div class="metric">
                <span class="metric-label">Memory:</span>
                <span class="metric-value" id="memoryUsage">2.1GB</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 84%"></div>
            </div>
            
            <div class="metric">
                <span class="metric-label">Neural Load:</span>
                <span class="metric-value" id="neuralLoad">91%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 91%"></div>
            </div>
            
            <div class="metric">
                <span class="metric-label">Responses:</span>
                <span class="metric-value" id="responseCount">247</span>
            </div>
        </div>

        <div id="memoryIndicator" class="memory-indicator">
            Aether remembers you!
        </div>

        <div class="character-container">
            <canvas id="characterCanvas" class="character-canvas"></canvas>
            <div id="characterLoading" class="character-loading">
                <div>Loading Aether...</div>
                <div class="loading-dots"></div>
            </div>
        </div>

        <div class="text-box">
            <div class="character-name">Aether</div>
            <div class="dialogue-text" id="dialogueText">
                <div class="message fairy">
                    Neural network initialized. I'm Aether, your advanced AI companion for this testing session. 
                    All systems are online and ready for interaction. What would you like to explore today?
                </div>
            </div>
            <div class="input-container">
                <span class="input-prompt">></span>
                <input type="text" class="message-input" id="messageInput" placeholder="Enter test command or message..." maxlength="500">
                <button class="mic-button" id="micButton" onclick="toggleSpeechRecognition()" title="Voice Input"></button>
                <button class="send-button" id="sendButton" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, fairy, mixer;
        let audioAutoPlay = false;
        let backgroundMusic = null;
        let messageReactions = new Map();
        let messageCounter = 0;
        let speechRecognition = null;
        let isRecording = false;
        let userMemory = {};
        let currentBackground = 'default';
        
        try {
            userMemory = JSON.parse(localStorage.getItem('bonkara_memory') || '{}');
            currentBackground = localStorage.getItem('bonkara_background') || 'default';
        } catch (e) {
            userMemory = {};
            currentBackground = 'default';
        }

        const backgrounds = {
            default: 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887cb12ef6fe7c6ece80324_anime-bedroom-uidy4uvprhbhg84q.jpg',
            gym: 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887f8d1a34ef0893b9b7841_3d179b3d1e4dd193869406730925be71.jpg',
            future: 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887f8d150076a190352ea5d_1e993a515f75ec9addd4c36eb6a74640%20(1)%20(1).png',
            streets: 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887f8fbcbc040107d95c8c3_bnef3fhuqm261%20(2).png',
            bonk: 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6887f9169ce3ce8776ce421c_51lJBZ66FTL.jpg'
        };

        const canvas = document.getElementById('characterCanvas');
        const loadingDiv = document.getElementById('characterLoading');
        const dialogueText = document.getElementById('dialogueText');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const micButton = document.getElementById('micButton');

        const soundEffects = {
            messageSend: null,
            messageReceived: null,
            reaction: null
        };

        function initSoundEffects() {
            soundEffects.messageSend = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFA==');
            soundEffects.messageReceived = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFA==');
            soundEffects.reaction = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFA==');
            
            Object.values(soundEffects).forEach(sound => {
                if (sound) sound.volume = 0.3;
            });
        }

        function playSound(soundName) {
            if (soundEffects[soundName]) {
                soundEffects[soundName].currentTime = 0;
                soundEffects[soundName].play().catch(e => console.log('Sound play failed:', e));
            }
        }

        function enterSite() {
            audioAutoPlay = true;
            
            const loadingScreen = document.getElementById('loadingScreen');
            const mainContent = document.getElementById('mainContent');
            
            loadingScreen.classList.add('hidden');
            mainContent.classList.add('visible');
            
            if (Object.keys(userMemory).length > 0) {
                showMemoryIndicator();
            }
            
            startBackgroundMusic();
            initSoundEffects();
            initSpeechRecognition();
            initThreeJS();
            initTestingControls();
        }

        // Testing control functions
        function initTestingControls() {
            // Initialize sliders
            const speedSlider = document.getElementById('speedSlider');
            const intensitySlider = document.getElementById('intensitySlider');
            
            speedSlider.addEventListener('input', function() {
                document.getElementById('speedValue').textContent = this.value;
            });
            
            intensitySlider.addEventListener('input', function() {
                document.getElementById('intensityValue').textContent = this.value;
            });
            
            // Start performance monitoring
            startPerformanceMonitoring();
        }

        function triggerPose(poseType) {
            console.log(`Triggering pose: ${poseType}`);
            // Add visual feedback
            const buttons = document.querySelectorAll('.control-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Animate character based on pose
            if (fairy) {
                switch(poseType) {
                    case 'idle':
                        fairy.rotation.y = 0;
                        break;
                    case 'wave':
                        // Simple wave animation
                        animateWave();
                        break;
                    case 'dance':
                        // Dance animation
                        animateDance();
                        break;
                }
            }
            
            setTimeout(() => {
                event.target.classList.remove('active');
            }, 2000);
        }

        function animateWave() {
            if (!fairy) return;
            let startTime = Date.now();
            function wave() {
                const elapsed = Date.now() - startTime;
                if (elapsed < 2000) {
                    fairy.rotation.z = Math.sin(elapsed / 200) * 0.2;
                    requestAnimationFrame(wave);
                } else {
                    fairy.rotation.z = 0;
                }
            }
            wave();
        }

        function animateDance() {
            if (!fairy) return;
            let startTime = Date.now();
            function dance() {
                const elapsed = Date.now() - startTime;
                if (elapsed < 3000) {
                    fairy.rotation.y = Math.sin(elapsed / 300) * 0.5;
                    fairy.position.y = -2.7 + Math.sin(elapsed / 200) * 0.1;
                    requestAnimationFrame(dance);
                } else {
                    fairy.rotation.y = 0;
                    fairy.position.y = -2.7;
                }
            }
            dance();
        }

        function resetCharacter() {
            if (fairy) {
                fairy.rotation.set(0, 0, 0);
                fairy.position.set(0, -2.7, 0);
                fairy.scale.set(2.0, 2.0, 2.0);
            }
            
            // Visual feedback
            event.target.classList.add('active');
            setTimeout(() => {
                event.target.classList.remove('active');
            }, 1000);
        }

        function toggleMemory() {
            // Toggle memory functionality
            const memoryActive = Object.keys(userMemory).length > 0;
            if (memoryActive) {
                localStorage.removeItem('bonkara_memory');
                userMemory = {};
                showNotification('Memory cleared');
            } else {
                showNotification('Memory system active');
            }
            
            event.target.classList.add('active');
            setTimeout(() => {
                event.target.classList.remove('active');
            }, 1000);
        }

        function exportLogs() {
            const logs = {
                timestamp: new Date().toISOString(),
                session_data: userMemory,
                performance: {
                    responses: document.getElementById('responseCount').textContent,
                    uptime: Date.now()
                }
            };
            
            const dataStr = JSON.stringify(logs, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'aether_session_log.json';
            link.click();
            
            event.target.classList.add('active');
            setTimeout(() => {
                event.target.classList.remove('active');
            }, 1000);
        }

        function emergencyStop() {
            // Emergency stop functionality
            if (backgroundMusic) {
                backgroundMusic.pause();
            }
            
            // Stop all animations
            if (mixer) {
                mixer.stopAllAction();
            }
            
            showNotification('EMERGENCY STOP ACTIVATED');
            
            event.target.classList.add('active');
            setTimeout(() => {
                event.target.classList.remove('active');
            }, 2000);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 255, 136, 0.9);
                color: black;
                padding: 10px 20px;
                border-radius: 5px;
                font-weight: bold;
                z-index: 1000;
                animation: fadeInOut 2s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        function startPerformanceMonitoring() {
            setInterval(() => {
                // Simulate performance metrics
                const cpu = Math.floor(Math.random() * 30) + 50;
                const memory = (Math.random() * 1 + 1.5).toFixed(1);
                const neural = Math.floor(Math.random() * 20) + 80;
                
                document.getElementById('cpuUsage').textContent = cpu + '%';
                document.getElementById('memoryUsage').textContent = memory + 'GB';
                document.getElementById('neuralLoad').textContent = neural + '%';
                
                // Update progress bars
                const progressBars = document.querySelectorAll('.progress-fill');
                progressBars[0].style.width = cpu + '%';
                progressBars[1].style.width = (memory / 4 * 100) + '%';
                progressBars[2].style.width = neural + '%';
            }, 2000);
        }

        function updateUserMemory(key, value) {
            userMemory[key] = value;
            localStorage.setItem('bonkara_memory', JSON.stringify(userMemory));
        }

        function getUserMemory() {
            return userMemory;
        }

        function showMemoryIndicator() {
            const indicator = document.getElementById('memoryIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 3000);
        }

        function toggleBackgroundSelector() {
            const selector = document.getElementById('backgroundSelector');
            selector.classList.toggle('open');
        }

        function setBackground(bgKey) {
            currentBackground = bgKey;
            const backgroundDiv = document.querySelector('.background');
            backgroundDiv.style.backgroundImage = `url('${backgrounds[bgKey]}')`;
            localStorage.setItem('bonkara_background', bgKey);
            
            document.querySelectorAll('.background-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelector(`[data-bg="${bgKey}"]`)?.classList.add('active');
        }

        function startBackgroundMusic() {
            try {
                backgroundMusic = new Audio('https://cdn.jsdelivr.net/gh/bartoai/fairy@main/background-music.mp3');
                backgroundMusic.loop = true;
                backgroundMusic.volume = 0.1;
                
                backgroundMusic.play().catch(error => {
                    console.log('Background music autoplay blocked:', error);
                    createMusicToggle();
                });
            } catch (error) {
                console.log('Background music failed to load:', error);
            }
        }

        function createMusicToggle() {
            const musicButton = document.createElement('button');
            musicButton.innerHTML = '🎵';
            musicButton.style.cssText = `
                position: fixed;
                top: 20px;
                right: 120px;
                z-index: 15;
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid #00ff00;
                color: #00ff00;
                padding: 8px 12px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
            `;
            
            let musicPlaying = false;
            musicButton.onclick = () => {
                if (!musicPlaying) {
                    backgroundMusic.play();
                    musicButton.innerHTML = '🔇';
                    musicPlaying = true;
                } else {
                    backgroundMusic.pause();
                    musicButton.innerHTML = '🎵';
                    musicPlaying = false;
                }
            };
            
            document.body.appendChild(musicButton);
        }

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                speechRecognition = new SpeechRecognition();
                
                speechRecognition.continuous = false;
                speechRecognition.interimResults = false;
                speechRecognition.lang = 'en-US';
                
                speechRecognition.onstart = function() {
                    isRecording = true;
                    micButton.className = 'mic-button recording';
                    micButton.textContent = '🔴';
                };
                
                speechRecognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    messageInput.value = transcript;
                };
                
                speechRecognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    resetMicButton();
                };
                
                speechRecognition.onend = function() {
                    resetMicButton();
                    if (messageInput.value.trim()) {
                        sendMessage();
                    }
                };
            } else {
                micButton.style.display = 'none';
            }
        }

        function toggleSpeechRecognition() {
            if (!speechRecognition) return;
            
            if (isRecording) {
                speechRecognition.stop();
            } else {
                speechRecognition.start();
            }
        }

        function resetMicButton() {
            isRecording = false;
            micButton.className = 'mic-button';
            micButton.textContent = '';
        }

        function initThreeJS() {
            scene = new THREE.Scene();

            const container = document.querySelector('.character-container');
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;

            camera = new THREE.PerspectiveCamera(45, containerWidth / containerHeight, 0.1, 1000);
            camera.position.set(0, 1.5, 2.2);
            camera.lookAt(0, 1.2, 0);

            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas, 
                antialias: true, 
                alpha: true 
            });
            
            renderer.setSize(containerWidth, containerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);

            const keyLight = new THREE.DirectionalLight(0xffffff, 1.2);
            keyLight.position.set(2, 3, 2);
            keyLight.castShadow = true;
            scene.add(keyLight);

            const fillLight = new THREE.DirectionalLight(0xa8c8ff, 0.6);
            fillLight.position.set(-2, 1, 1);
            scene.add(fillLight);

            setTimeout(() => {
                onWindowResize();
            }, 100);

            loadFairyModel();
        }

        function loadFairyModel() {
            const loader = new THREE.GLTFLoader();
            const modelUrl = 'https://cdn.jsdelivr.net/gh/bartoai/fairy@main/fairywoman.glb';
            
            const manager = new THREE.LoadingManager();
            loader.manager = manager;
            
            loader.load(
                modelUrl,
                function(gltf) {
                    fairy = gltf.scene;
                    
                    fairy.scale.set(2.0, 2.0, 2.0);
                    fairy.position.set(0, -2.7, 0);
                    
                    fairy.traverse(function(child) {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            if (child.material) {
                                child.material.needsUpdate = true;
                            }
                        }
                    });
                    
                    scene.add(fairy);
                    
                    loadingDiv.style.display = 'none';
                    canvas.style.display = 'block';
                    
                    setTimeout(() => {
                        onWindowResize();
                        renderer.render(scene, camera);
                    }, 50);
                    
                    if (gltf.animations && gltf.animations.length > 0) {
                        mixer = new THREE.AnimationMixer(fairy);
                        const action = mixer.clipAction(gltf.animations[0]);
                        action.play();
                    }
                    
                    animate();
                },
                function(progress) {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    loadingDiv.innerHTML = `
                        <div>Loading Bonkara... ${percent}%</div>
                        <div class="loading-dots"></div>
                    `;
                },
                function(error) {
                    console.error('Error loading model:', error);
                    loadingDiv.innerHTML = `
                        <div>Failed to load model</div>
                        <div style="font-size: 12px; margin-top: 5px;">
                            Check connection and try refreshing
                        </div>
                    `;
                }
            );
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (mixer) {
                mixer.update(0.008);
            }
            
            if (fairy && !mixer) {
                fairy.position.y = Math.sin(Date.now() * 0.001) * 0.02;
            }
            
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            if (camera) {
                camera.aspect = containerWidth / containerHeight;
                camera.updateProjectionMatrix();
            }
            
            if (renderer) {
                renderer.setSize(containerWidth, containerHeight);
            }
            
            if (scene && camera && renderer) {
                renderer.render(scene, camera);
            }
        }

        window.addEventListener('resize', onWindowResize);

        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            playSound('messageSend');
            addMessage(message, 'user');
            messageInput.value = '';
            sendButton.disabled = true;
            sendButton.innerHTML = 'Sending<span class="loading-dots"></span>';

            showTypingIndicator();

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        character: 'bonkara',
                        userMemory: getUserMemory()
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                
                hideTypingIndicator();
                addMessage(data.response, 'fairy');
                playSound('messageReceived');
            } catch (error) {
                console.error('API Error:', error);
                const fallbackResponses = [
                    "How fascinating! The ancient trees have been whispering about visitors like you.",
                    "That question carries the scent of adventure! I can sense great potential within you.",
                    "Oh my! You remind me of the wise spirits who dwell beyond the crystal caves.",
                    "The moonlight reveals that you seek something deeper than words can express.",
                    "Your energy resonates with the harmony of the enchanted grove."
                ];
                
                const randomResponse = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                hideTypingIndicator();
                addMessage(randomResponse, 'fairy');
                playSound('messageReceived');
            }

            sendButton.disabled = false;
            sendButton.innerHTML = 'Send';
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = 'Bonkara is typing<span class="loading-dots">...</span>';
            dialogueText.appendChild(typingDiv);
            dialogueText.scrollTop = dialogueText.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            const messageId = ++messageCounter;
            messageDiv.dataset.messageId = messageId;
            
            if (sender === 'fairy') {
                const voiceButton = document.createElement('button');
                voiceButton.className = 'voice-button';
                voiceButton.textContent = '🔊';
                voiceButton.onclick = () => playVoice(text, voiceButton);
                messageDiv.appendChild(voiceButton);
                
                const reactionContainer = document.createElement('div');
                reactionContainer.className = 'reaction-buttons';
                
                const reactions = ['❤️', '😍', '🔥', '😱', '😂'];
                reactions.forEach(emoji => {
                    const reactionBtn = document.createElement('button');
                    reactionBtn.className = 'reaction-btn';
                    reactionBtn.textContent = emoji;
                    reactionBtn.onclick = () => addReaction(messageId, emoji);
                    reactionContainer.appendChild(reactionBtn);
                });
                
                messageDiv.appendChild(reactionContainer);
                
                const reactionsDisplay = document.createElement('div');
                reactionsDisplay.className = 'user-reactions';
                reactionsDisplay.id = `reactions-${messageId}`;
                messageDiv.appendChild(reactionsDisplay);
                
                dialogueText.appendChild(messageDiv);
                
                if (audioAutoPlay) {
                    prepareAndPlayTogether(messageDiv, text);
                } else {
                    typeMessage(messageDiv, text);
                }
            } else {
                messageDiv.textContent = text;
                dialogueText.appendChild(messageDiv);
            }
            
            dialogueText.scrollTop = dialogueText.scrollHeight;
        }

        function addReaction(messageId, emoji) {
            playSound('reaction');
            
            if (!messageReactions.has(messageId)) {
                messageReactions.set(messageId, new Map());
            }
            
            const messageReactionMap = messageReactions.get(messageId);
            const currentCount = messageReactionMap.get(emoji) || 0;
            messageReactionMap.set(emoji, currentCount + 1);
            
            updateReactionsDisplay(messageId);
        }

        function updateReactionsDisplay(messageId) {
            const reactionsDisplay = document.getElementById(`reactions-${messageId}`);
            const messageReactionMap = messageReactions.get(messageId);
            
            if (!reactionsDisplay || !messageReactionMap) return;
            
            let html = '';
            messageReactionMap.forEach((count, emoji) => {
                if (count > 0) {
                    html += `<span class="reaction-count">${emoji} ${count}</span>`;
                }
            });
            
            reactionsDisplay.innerHTML = html;
        }

        function typeMessage(element, text, callback, speed = 30) {
            let i = 0;
            element.textContent = '';
            
            function typeChar() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    dialogueText.scrollTop = dialogueText.scrollHeight;
                    setTimeout(typeChar, speed);
                } else if (callback) {
                    callback();
                }
            }
            
            typeChar();
        }

        async function prepareAndPlayTogether(element, text) {
            try {
                element.textContent = '...';
                
                const response = await fetch('/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });

                if (response.ok) {
                    const data = await response.json();
                    const audio = new Audio();
                    audio.src = `data:audio/mpeg;base64,${data.audio}`;
                    
                    audio.play().catch(e => console.log('Auto-play failed:', e));
                    typeMessage(element, text);
                } else {
                    typeMessage(element, text);
                }
            } catch (error) {
                console.log('Audio preparation failed:', error);
                typeMessage(element, text);
            }
        }

        async function playVoice(text, button) {
            if (button.disabled) return;
            
            button.disabled = true;
            button.classList.add('playing');
            button.textContent = '⏸️';
            
            try {
                const response = await fetch('/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });

                if (!response.ok) {
                    throw new Error('TTS request failed');
                }

                const data = await response.json();
                
                const audio = new Audio();
                audio.src = `data:audio/mpeg;base64,${data.audio}`;
                
                audio.onended = () => {
                    button.disabled = false;
                    button.classList.remove('playing');
                    button.textContent = '🔊';
                };
                
                audio.onerror = () => {
                    button.disabled = false;
                    button.classList.remove('playing');
                    button.textContent = '🔊';
                    console.error('Audio playback failed');
                };
                
                await audio.play();
                
            } catch (error) {
                console.error('Voice generation failed:', error);
                button.disabled = false;
                button.classList.remove('playing');
                button.textContent = '🔊';
            }
        }
    </script>
</body>
</html>
</head>
